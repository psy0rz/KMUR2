
<script>

new ControlForm({
    'view'            : view,
    'context'         : '.group',
    'class'           : 'example.Groups',
    'get_params'      : view.params,
    'default_focus'   : 'name',
    'title'           : 'Edit group {name}',
    'title_new'       : 'New group',
    'favorite_menu'   : 'example'
});

new ControlListRelated({
    'view'            	: view,
    'context'           : '.members',
    'class'        		: 'example.Members',
    'endless_scrolling'	: true,
    'related_key'       : 'group_ids',
    'related_value'     : view.params._id,
    'unrelate_confirm'  : 'Do you want to remove {name} from this group?'
});

new ControlListRelated({
    'view'              : view,
    'context'           : '.members2',
    'class'             : 'example.Members',
    'endless_scrolling' : true,
    'related_key'       : 'group_ids2',
    'related_value'     : view.params._id,
    'unrelate_confirm'  : 'Do you want to remove {name} from this group?'
});

new ControlListRelated({
    'view'              : view,
    'context'           : '.member',
    'class'             : 'example.Members',
    'endless_scrolling' : true,
    'related_key'       : 'group_id',
    'related_value'     : view.params._id,
    'unrelate_confirm'  : 'Do you want to remove {name} from this group?'
});

new ControlListRelated({
    'view'              : view,
    'context'           : '.member2',
    'class'             : 'example.Members',
    'endless_scrolling' : true,
    'related_key'       : 'group_id2',
    'related_value'     : view.params._id,
    'unrelate_confirm'  : 'Do you want to remove {name} from this group?'
});


</script>
<p>This example demonstrates how edit a group and add members to it. Since a member points to a group, and not the other way around, we need to use two ControlLists that handle all the complexeties involved.
<fieldset class='group'>
    <legend>Group settings</legend>
    <table>
    	<tr>
    		<td class='field-meta-put' field-key='name' field-meta-key='desc'>
    		<td class='field-meta-put' field-key='name'>
    	</tr>
    </table>
    <div class='viewErrorClass'>
        <button class='control-on-click-save' >Save</button>
        <button class='control-on-click-del control-hide-on-new' >Delete</button>
        <button class='control-on-click-cancel' >Cancel</button>
        <span class='viewErrorText'></span>
    </div>
</fieldset>

<fieldset>
    <legend>Members of this group</legend>
    <fieldset class='members control-hide-on-new'>
        <legend class='field-meta-put' field-key='group_ids' field-meta-key='desc'></legend>
        <table >
            <tr class='ui-widget-header'>
                <th class='field-meta-put control-on-click-order control-order-asc' field-key='name' field-meta-key='desc'>
                <th>
            </tr>

            <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='' field-list-view="example.Members.edit">
                <td class='field-list-on-click-view field-put' field-key='name' >
                <td class='control-relation-on-click-del ui-icon ui-icon-minus'>
            </tr>
            <tr class='ui-widget-content'>
                <td><input class='control-relation-on-change-autocomplete' search-keys='name' result-format='{name} ({_id})' />
                <td class='control-relation-on-click-add ui-icon ui-icon-plus'>
            </tr>
            <tr>
                <td colspan=2><a class='field-list-on-click-view' field-key='name' href='#'>Create new member</a>
            </tr>
        </table>
    </fieldset>

    <fieldset class='members2 control-hide-on-new'>
        <legend class='field-meta-put' field-key='group_ids2' field-meta-key='desc'></legend>
        <table >
            <tr class='ui-widget-header'>
                <th class='field-meta-put control-on-click-order control-order-asc' field-key='name' field-meta-key='desc'>
                <th>
            </tr>

            <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='' field-list-view="example.Members.edit">
                <td class='field-list-on-click-view field-put' field-key='name' >
                <td class='control-relation-on-click-del ui-icon ui-icon-minus'>
            </tr>
            <tr class='ui-widget-content'>
                <td><input class='control-relation-on-change-autocomplete' search-keys='name' result-format='{name} ({_id})' />
                <td class='control-relation-on-click-add ui-icon ui-icon-plus'>
            </tr>
            <tr>
                <td colspan=2><a class='field-list-on-click-view' field-key='name' href='#'>Create new member</a>
            </tr>
        </table>
    </fieldset>


    <fieldset class='member control-hide-on-new'>
        <legend class='field-meta-put' field-key='group_id' field-meta-key='desc'></legend>
        <table >
            <tr class='ui-widget-header'>
                <th class='field-meta-put control-on-click-order control-order-asc' field-key='name' field-meta-key='desc'>
                <th>
            </tr>

            <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='' field-list-view="example.Members.edit">
                <td class='field-list-on-click-view field-put' field-key='name' >
                <td class='control-relation-on-click-del ui-icon ui-icon-minus'>
            </tr>
            <tr class='ui-widget-content'>
                <td><input class='control-relation-on-change-autocomplete' search-keys='name' result-format='{name} ({_id})' />
                <td class='control-relation-on-click-add ui-icon ui-icon-plus'>
            </tr>
            <tr>
                <td colspan=2><a class='field-list-on-click-view' field-key='name' href='#'>Create new member</a>
            </tr>

        </table>
    </fieldset>


    <fieldset class='member2 control-hide-on-new'>
        <legend class='field-meta-put' field-key='group_id2' field-meta-key='desc'></legend>
        <table >
            <tr class='ui-widget-header'>
                <th class='field-meta-put control-on-click-order control-order-asc' field-key='name' field-meta-key='desc'>
                <th>
            </tr>

            <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='' field-list-view="example.Members.edit">
                <td class='field-list-on-click-view field-put' field-key='name' >
                <td class='control-relation-on-click-del ui-icon ui-icon-minus'>
            </tr>
            <tr class='ui-widget-content'>
                <td><input class='control-relation-on-change-autocomplete' search-keys='name' result-format='{name} ({_id})' />
                <td class='control-relation-on-click-add ui-icon ui-icon-plus'>
            </tr>
            <tr>
                <td colspan=2><a class='field-list-on-click-view' field-key='name' href='#'>Create new member</a>
            </tr>
        </table>
    </fieldset>
</fieldset>


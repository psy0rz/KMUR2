
<script>

var form=new ControlForm({
    'view'            : view,
    'class'           : 'ticket.Relations',
    'get_params'      : view.params,
    'default_focus'   : 'title',
    'title'           : 'Edit relation {title}',
    'title_new'       : 'New relation',
    'favorite_menu'   : 'relations',
    'default'         : { 
        'allowed_users': [ session.user_id ],
        'allowed_groups': [ ]
    }
});

</script>


<table>
	<tr>
		<td class='field-meta-put' field-key='title' field-meta-key='desc'>
		<td class='field-meta-put' field-key='title'>
	</tr>
    <tr>
        <td class='field-meta-put' field-key='desc' field-meta-key='desc'>
        <td><textarea class='field-put field-get field-input' field-key='desc' cols=40 rows=5></textarea>
    </tr>


</table>

<fieldset style='display:inline-block;'>
    <legend class='field-meta-put' field-key='emails' field-meta-key='desc'></legend>

    <table >
        <thead >
            <tr class='field-meta-put ui-widget-header' field-key='emails'>
                <td>
                <td class='field-meta-put' field-key='emails.email' field-meta-key='desc'>
                <td class='field-meta-put' field-key='emails.desc' field-meta-key='desc'>
                <td>
                <td>
            </tr>
        </thead>
        <tbody class=''>
            <tr class='colorRows field-list-sortable field-meta-put field-list-source ui-widget-content' field-key='emails'>
                <td class='field-list-on-drag-sort ui-icon ui-icon-arrowthick-2-n-s'> 
                <td class='field-meta-put field-list-on-focus-add' field-key='emails.email'>
                <td class='field-meta-put field-list-on-focus-add' field-key='emails.desc'>
                <td class='field-list-on-click-del ui-icon ui-icon-trash'>
                <td class='field-list-on-click-add ui-icon ui-icon-plus'>
            </tr>
        </tbody>
    </table>

</fieldset>

<fieldset style='display:inline-block;'>
    <legend class='field-meta-put' field-key='phones' field-meta-key='desc'></legend>
    <table >
        <thead >
            <tr class='field-meta-put ui-widget-header' field-key='phones'>
                <td>
                <td class='field-meta-put' field-key='phones.phone' field-meta-key='desc'>
                <td class='field-meta-put' field-key='phones.desc' field-meta-key='desc'>
                <td>
                <td>
            </tr>
        </thead>
        <tbody class=''>
            <tr class='colorRows field-list-sortable field-meta-put field-list-source ' field-key='phones'>
                <td class='field-list-on-drag-sort ui-icon ui-icon-arrowthick-2-n-s'> 
                <td class='field-meta-put field-list-on-focus-add' field-key='phones.phone'>
                <td class='field-meta-put field-list-on-focus-add' field-key='phones.desc'>
                <td class='field-list-on-click-del ui-icon ui-icon-trash'>
                <td class='field-list-on-click-add ui-icon ui-icon-plus'>
            </tr>
        </tbody>
    </table>
</fieldset>

<fieldset style='display:block;'>
<legend>Sharing</legend>

    <fieldset style='display:inline-block;'>
        <legend class='field-meta-put' field-key='allowed_users' field-meta-key='desc'></legend>
        <table class='field-meta-put' field-key='allowed_users'>
            <tr class='ui-widget-header'>
                <th class='field-meta-put' field-key='allowed_users.name' field-meta-key='desc'>
                <th>
            </tr>

            <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='allowed_users' field-list-view="core.Users.edit">
                <td class='field-put field-list-on-click-view' field-key='allowed_users.fullname'>
                <td class='field-list-on-click-del ui-icon ui-icon-minus'>
            </tr>
            <tr class='ui-widget-content'>
                <td><input class='field-relation-on-change-autocomplete' search-keys='name fullname' result-format='{fullname}' />
                <td class='field-relation-on-click-add ui-icon ui-icon-plus'>
            </tr>
            <tr>
                <td colspan=2 class='field-list-on-click-view' field-key='name'> <a href='#'>Create new user</a>
            </tr>
        </table>
    </fieldset>

    <fieldset style='display:inline-block;'>
        <legend class='field-meta-put' field-key='allowed_groups' field-meta-key='desc'></legend>
        <table class='field-meta-put' field-key='allowed_groups'>
            <tr class='ui-widget-header'>
                <th class='field-meta-put' field-key='allowed_groups.name' field-meta-key='desc'>
                <th>
            </tr>

            <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='allowed_groups' field-list-view="core.Groups.edit">
                <td class='field-put field-list-on-click-view' field-key='allowed_groups.name'>
                <td class='field-list-on-click-del ui-icon ui-icon-minus'>
            </tr>
            <tr class='ui-widget-content'>
                <td><input class='field-relation-on-change-autocomplete' search-keys='name' result-format='{name}' />
                <td class='field-relation-on-click-add ui-icon ui-icon-plus'>
            </tr>
            <tr>
                <td colspan=2 class='field-list-on-click-view' field-key='name'> <a href='#'>Create new group</a>
            </tr>
        </table>
    </fieldset>

</fieldset>


<div class='floatingBar viewErrorClass'>
	<button class='control-on-click-save' >Save</button>
	<button class='control-on-click-del control-hide-on-new' >Delete</button>
	<button class='control-on-click-cancel' >Cancel</button>
	<span class='viewErrorText'></span>
</div>

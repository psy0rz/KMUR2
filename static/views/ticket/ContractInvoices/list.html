
<script>
    new ControlList({
        'view'            	: view,
        'class'        		: 'ticket.ContractInvoices',
        'get_params'        : {
            "match": {
                'relation': view.params.relation_id
                }
        },
        'title'           	: 'Contract orders',
        'endless_scrolling'	: true,
        'create_view_params': {
            'relation_id': view.params.relation_id 
        }
    });

    $(".on-click-contract-invoices-invoice-all", context).click(function()
    {
        //this should be a cronjob as well
        rpc("ticket.ContractInvoices.invoice_all",{
            relation_id: view.params.relation_id
        }, function(result)
        {
            viewShowError(result, context);
        });
        return(false);
    });
</script>

<span class="ui-icon ui-icon-search" style='display:inline-block'></span>
<input type='text' class='control-on-change-search control-default-focus' control-search-keys='contract_title desc'>

<table >
    <tr class='ui-widget-header'>
        <th>
        <th class='field-meta-put control-on-click-order control-order-desc' field-key='date' field-meta-key='desc'>
        <th class='field-meta-put control-on-click-order' field-key='contract_title' field-meta-key='desc'>
        <th class='field-meta-put control-on-click-order' field-key='desc' field-meta-key='desc'>
        <th class='field-meta-put control-on-click-order' field-key='minutes_used' field-meta-key='desc'>
        <th class='field-meta-put control-on-click-order' field-key='minutes_bought' field-meta-key='desc'>
        <th class='field-meta-put control-on-click-order' field-key='minutes_balance' field-meta-key='desc'>
    	<th>
    </tr>


    <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='' field-list-view="ticket.ContractInvoices.edit">
        <td class='field-list-on-click-view ticket-show-button-style' field-list-view="ticket.ContractInvoices.show">&nbsp;
        <td class='field-put field-list-on-click-view' field-key='date' >
        <td class='field-put field-list-on-click-view' field-key='contract_title' >
        <td class='field-put field-list-on-click-view' field-key='desc' >
        <td class='field-put field-list-on-click-view' field-key='minutes_used' >
        <td class='field-put field-list-on-click-view' field-key='minutes_bought' >
        <td class='field-put field-list-on-click-view' field-key='minutes_balance' >

    	<td class='control-on-click-del ui-icon ui-icon-trash'>
    </tr>

</table>

<div class='floatingBar viewErrorClass'>
    <button class='control-on-click-view' control-view='ticket.ContractInvoices.edit' field-key='desc' >Create new order</button>
    <button class='on-click-contract-invoices-invoice-all' >Auto invoice</button>

    <span class='viewErrorText'></span>
</div>


<script>

var form=new ControlForm({
    'view'            : view,
    'class'           : 'ticket.Tickets',
    'get_params'      : view.params,
    'on_change'       : 'put',
    'title'           : 'View task {title}',
    'favorite_menu'   : 'ticket',
    'context'         : '.ticket',
    'create_view_params': view.params,
    'get_result': function(result)
    {
        $(".new-ticket-item", context).click(function()
        {
            viewCreate({ creator: context },
            {
                name: 'ticket.TicketObjects.edit',
                mode: 'main',
                params: {
                    ticket_id: view.params._id
                }
            });

        });


    }
});



new ControlListRelated({
    'view'              : view,
    'context'           : '.ticket-objects',
    'class'             : 'ticket.TicketObjects',
    'endless_scrolling' : true,
    'on_change'         : 'get',
    'related_key'       : 'tickets',
    'related_value'     : view.params._id,
    'unrelate_confirm'  : "Do you want to remove task item '{title}' from this ticket?",
    'create_view_params': {
        'group_ids': [ view.params._id ]
    }
});

new ControlListRelated({
    'view'              : view,
    'context'           : '.ticket-depends',
    'class'             : 'ticket.Tickets',
    'endless_scrolling' : false,
    'related_key'       : 'tickets',
    'related_value'     : view.params._id,
});

</script>

<input>

<span class='ticket'>
    <span control-view="ticket.Tickets.edit">

        <table class='inline-block'>
            <tr>
                <td class='field-meta-put control-on-click-view' field-key='ticket_completed' field-meta-key='desc'>
                <td class='field-put value control-on-click-view' field-key='ticket_completed'>
            </tr>
            <tr>
                <td class='field-meta-put control-on-click-view' field-key='title' field-meta-key='desc'>
                <td style='font-weight:bold' class='field-put value control-on-click-view' field-key='title'>
            </tr>
            <tr>
                <td class='field-meta-put control-on-click-view' field-key='desc' field-meta-key='desc'>
                <td class='field-put value control-on-click-view' field-key='desc'>
            </tr>
            <tr>
                <td class='field-meta-put control-on-click-view nowrap' field-key='start_date' field-meta-key='desc'>
                <td class='field-put value control-on-click-view nowrap'  field-key='start_date'>
            </tr>
            <tr>
                <td class='field-meta-put control-on-click-view nowrap' field-key='due_date' field-meta-key='desc'>
                <td class='field-put value control-on-click-view nowrap'  field-key='due_date'>
            </tr>
            <tr>
                <td class='field-meta-put control-on-click-view nowrap' field-key='ticket_status' field-meta-key='desc'>
                <td class='field-put value control-on-click-view nowrap'  field-key='ticket_status'>
            </tr>
            <tr>
                <td class='field-meta-put control-on-click-view nowrap' field-key='ticket_priority' field-meta-key='desc'>
                <td class='field-put value control-on-click-view nowrap'  field-key='ticket_priority'>
            </tr>
            <tr>
                <td class='field-meta-put control-on-click-view' field-key='relations' field-meta-key='desc'>
                <td class='field-meta-put control-on-click-view' field-key='relations'>
                    <span class='list-span field-list-source field-list-source-hide' field-key='relations' field-list-view="ticket.Relations.edit">
                        <span class='field-put' field-key='relations.title'></span>
                    </span>
            </tr>
        </table>

        <fieldset class='inline-block'>
        <legend>Sharing</legend>
            <table >
                <tr class='field-meta-put control-on-click-view' field-key='allowed_users'>
                    <td class='field-meta-put' field-key='allowed_users' field-meta-key='desc'>
                    <td>:
                        <span class='field-list-source field-list-source-hide' field-key='allowed_users' field-list-view="core.Users.edit">
                            <span class='list-span field-put field-list-on-click-view' field-key='allowed_users.name'></span>
                        </span>
                </tr>

                <tr class='field-meta-put control-on-click-view'  field-key='allowed_groups'>
                    <td class='field-meta-put' field-key='allowed_groups' field-meta-key='desc'>
                    <td>:
                        <span class='field-list-source field-list-source-hide' field-key='allowed_groups' field-list-view="core.Groups.edit">
                            <span class='list-span field-put field-list-on-click-view' field-key='allowed_groups.name'></span>
                        </span>
                </tr>
            </table>
        </fieldset>

        <fieldset class='inline-block'>
            <legend class='field-meta-put' field-key='tickets' field-meta-key='desc'></legend>
            <table class='field-meta-put field-key-root' field-key='tickets'>
                <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='tickets' field-list-view="ticket.Tickets.show">
                    <td class='field-put field-list-on-click-view' field-key='tickets.ticket_status'>
                    <td class='field-put field-list-on-click-view' field-key='tickets.title'>
                </tr>
            </table>
        </fieldset>

    </span>
</span>


<fieldset class='ticket-depends inline-block'>
    <legend>Tasks that depend on us</legend>
    <table >
        <tr class='colorRows field-list-source field-list-source-hide ui-widget-content' field-key='' field-list-view="ticket.Tickets.show">
            <td class='field-list-on-click-view field-put' field-key='ticket_status' >
            <td class='field-list-on-click-view field-put' field-key='title' >
        </tr>
    </table>
</fieldset>




<fieldset class='ticket-objects control-hide-on-new'>
    <legend>Task history and notes</legend>
    <span class="ui-icon ui-icon-search" style='display:inline-block'></span>
    <input type='text' class='control-on-change-search control-default-focus' control-search-keys='title text'>

    <table >
        <tr class='ui-widget-header'>
            <th class='field-meta-put control-on-click-order control-order-desc' field-key='create_time' field-meta-key='desc' >
            <th class='field-meta-put control-on-click-order' field-key='type' field-meta-key='desc'>
            <th class='field-meta-put control-on-click-order' field-key='title' field-meta-key='desc'>
            <th>
        </tr>

        <tr class='colorRows field-list-source field-list-add-after field-list-source-hideX ui-widget-content' field-key='' field-list-view="ticket.TicketObjects.edit">
            <td class='field-list-on-click-view field-put' field-key='create_time' field-timestamp-allow-time>
            <td class='field-list-on-click-view field-put' field-key='type' >
            <td class='field-list-on-click-view field-put' field-key='title' >
        </tr>
    </table>
</fieldset>

<div class='floatingBar viewErrorClass'>
	<button class='new-ticket-item' >Add notes to ticket</button>
	<button class='control-on-click-cancel' >Back to overview</button>
	<span class='viewErrorText'></span>
</div>

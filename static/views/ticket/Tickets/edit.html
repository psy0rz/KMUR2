
<script>


var form=new ControlForm({
    'view'            : view,
    'class'           : 'ticket.Tickets',
    'get_params'      : { '_id': view.params._id },
    'default_focus'   : 'title',
    'title'           : 'Edit task {title}',
    'title_new'       : 'New task',
    // 'favorite_menu'   : 'ticket',
    'default'         : { 
        'deligated_users': view.params.deligated_users,
        'allowed_groups': view.params.allowed_groups,
        'owner': session.user_id,
        'start_date': new Date().getTime()/1000,
        'due_date': new Date().getTime()/1000,
        'relations': view.params.relations,
        'tickets'  : view.params.tickets,
        'ticket_status': view.params.ticket_status,
        'title': view.params.title,

    }
});



</script>


<table class='inline-block'>
    <tr>
        <td class='field-meta-put' field-key='ticket_completed' field-meta-key='desc'>
        <td class='field-meta-put' field-key='ticket_completed'>
    </tr>
	<tr>
		<td class='field-meta-put' field-key='title' field-meta-key='desc'>
		<td class='field-meta-put' field-key='title'>
	</tr>
    <tr>
        <td class='field-meta-put' field-key='desc' field-meta-key='desc'>
        <td><textarea class='field-put field-get field-input' field-key='desc' cols=80 rows=10></textarea>
    </tr>
    <tr>
        <td class='field-meta-put' field-key='start_date' field-meta-key='desc'>
        <td class='field-meta-put' field-key='start_date'>
    </tr>
    <tr>
        <td class='field-meta-put' field-key='due_date' field-meta-key='desc'>
        <td class='field-meta-put' field-key='due_date'>
    </tr>
    <tr>
        <td class='field-meta-put' field-key='ticket_status' field-meta-key='desc'>
        <td class='field-meta-put' field-key='ticket_status'>
    </tr>
    <tr>
        <td class='field-meta-put' field-key='ticket_priority' field-meta-key='desc'>
        <td class='field-meta-put' field-key='ticket_priority'>
    </tr>

    <tr>
        <td class='field-meta-put' field-key='relations' field-meta-key='desc'>
        <td class='field-meta-put field-key-root' field-key='relations' >
            <span >
                <span field-list-view="ticket.Relations.edit" class='list-span-form field-list-source notranslate field-list-source-hide' field-key='relations' >
                        <span class='field-put field-list-on-click-view' field-key='relations.title'></span>
                        <span class='field-list-on-click-del  ui-icon ui-icon-close'></span>
                </span>
                <span class='list-span-form'>
                    <input class='field-relation-on-change-autocomplete field-relation-on-click-add ' search-keys='title desc' result-format='{title}' sort-key='title' />
                    <span class='field-list-on-click-view ui-icon ui-icon-plus ' field-key='relations.title'></span>
                </span>
            </span>
    </tr>


    <tr>
        <td class='field-meta-put' field-key='tickets' field-meta-key='desc'>
        <td>
        <table class='field-meta-put field-key-root' style='border-width: 1px; border-style:solid' field-key='tickets'>

            <tr class='colorRows field-list-source notranslate field-list-source-hide ui-widget-content' field-key='tickets' field-list-view="ticket.Tickets.show">
                <td class='field-list-on-click-view field-put ticket-check-style' field-key='tickets.ticket_completed' field-no-text>
                <td class='field-put field-list-on-click-view' field-key='tickets.title'>
                <td class='field-list-on-click-view field-put ticket-status-style' field-key='tickets.ticket_status' >
                <td class='field-list-on-click-del ui-icon ui-icon-close'>
            </tr>
            <tr class='ui-widget-content'>
                <td>
                <td><input class='field-relation-on-click-add field-relation-on-change-autocomplete' search-keys='title desc' result-format='{title}' />
                <td>
                <td field-list-view="ticket.Tickets.edit" class='field-list-on-click-view ui-icon ui-icon-plus' field-key='tickets.title' sort-key='tickets.title'>
            </tr>
        </table>
    </tr>


    <tr>
        <td class='field-meta-put ticket-sharing-permissions' field-key='owner' field-meta-key='desc'>
        <td class='field-meta-put field-key-root' field-key='owner' >
            <span >
                <span field-list-view="core.Users.edit" class='list-span-form field-list-source notranslate field-list-source-hide' field-key='owner' >
                        <span class='ticket-sharing-deligated field-put field-list-on-click-view' field-key='owner.name'></span>
                        <span class='field-list-on-click-del  ui-icon ui-icon-close'></span>
                </span>
                <span class='list-span-form'>
                    <input class='field-relation-on-change-autocomplete field-relation-on-click-add ' search-keys='name' result-format='{name}' sort-key='name' />
                    <span class='field-list-on-click-view ui-icon ui-icon-plus ' field-key='owner.name'></span>
                </span>
            </span>
    </tr>

    <tr>
        <td class='field-meta-put ticket-sharing-permissions' field-key='deligated_users' field-meta-key='desc'>
        <td class='field-meta-put field-key-root' field-key='deligated_users' >
            <span >
                <span field-list-view="core.Users.edit" class='list-span-form field-list-source notranslate field-list-source-hide' field-key='deligated_users' >
                        <span class='ticket-sharing-deligated field-put field-list-on-click-view' field-key='deligated_users.name'></span>
                        <span class='field-list-on-click-del  ui-icon ui-icon-close'></span>
                </span>
                <span class='list-span-form'>
                    <input class='field-relation-on-change-autocomplete field-relation-on-click-add ' search-keys='name' result-format='{name}' sort-key='name' />
                    <span class='field-list-on-click-view ui-icon ui-icon-plus ' field-key='deligated_users.name'></span>
                </span>
            </span>
    </tr>

    <tr>
        <td class='field-meta-put ticket-sharing-permissions' field-key='allowed_groups' field-meta-key='desc'>
        <td class='field-meta-put field-key-root' field-key='allowed_groups' >
            <span >
                <span field-list-view="core.Groups.edit" class='list-span-form field-list-source notranslate field-list-source-hide' field-key='allowed_groups' >
                        <span class='ticket-sharing-group field-put field-list-on-click-view' field-key='allowed_groups.name'></span>
                        <span class='field-list-on-click-del  ui-icon ui-icon-close'></span>
                </span>
                <span class='list-span-form'>
                    <input class='field-relation-on-change-autocomplete field-relation-on-click-add ' search-keys='name' result-format='{name}' sort-key='name' />
                    <span class='field-list-on-click-view ui-icon ui-icon-plus ' field-key='allowed_groups.name'></span>
                </span>
            </span>
    </tr>

</table>



<div class='floatingBar viewErrorClass'>
	<button class='control-on-click-save' >Save</button>
	<button class='control-on-click-del control-hide-on-new' >Delete</button>
	<button class='control-on-click-cancel' >Cancel</button>
	<span class='viewErrorText'></span>
</div>
